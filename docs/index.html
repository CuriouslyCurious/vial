<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>vial: a micro micro-framework</title>
    <style type="text/css">
      body {
        margin: 40px auto;
        line-height: 1.6;
        font-size: 20px;
        color: #444;
        padding: 16px;
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica,
          Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;
      }

      /* big logo */
      h1:first-of-type {
        font-size: 80px;
        margin-bottom: 0;
        margin-top: -20px;
        padding-top: 0;
      }
      h4:first-of-type {
        margin: 0;
        font-size: 20px;
        color: #aaa;
        margin-top: -10px;
        margin-bottom: 20px;
        font-weight: normal;
        font-style: italic;
      }
      img:first-of-type {
        margin-top: -25px;
        margin-right: 20px;
      }

      /* structure */
      nav {
        float: left;
        padding-top: 0;
      }
      main {
        margin: 0 auto;
        max-width: 900px;
      }

      nav.show-mobile {
        display: block;
      }

      /* medium size */
      @media (max-width: 1500px) {
        main {
          padding-left: 15px;
          float: left;
        }
        img:first-of-type {
          margin-top: -45px;
        }
        nav.show-mobile {
          display: block;
        }
      }

      /* small size */
      @media (max-width: 1240px) {
        nav {
          display: none;
        }
        nav.show-mobile {
          display: block;
          font-size: 120%;
          margin-left: 200px;
          width: 100%;
        }
        nav.show-mobile h3 {
          font-size: 120%;
        }
        main {
          float: none;
          margin: 0 auto;
        }
        #menu-toggle {
          display: block !important;
        }
      }
      @media (max-width: 900px) {
        main {
          max-width: none !important;
          width: 100% !important;
        }
      }
      /* iphone portrait mode */
      @media only screen and (min-device-width: 375px) and (max-device-width: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait) {
        h1 {
          font-size: 4.5em !important;
        }
        h2 {
          font-size: 3.5em !important;
        }

        p,
        pre code {
          font-size: 2.5em !important;
        }
        h3,
        h4 {
          font-size: 2.5em !important;
        }
        img:first-of-type {
          height: 220px;
        }
      }

      /* regular stuff */
      a {
        color: black;
        text-decoration: none;
        border-bottom: 1px solid black;
      }
      a:visited {
        color: #666;
        text-decoration: none;
      }
      a:hover {
        border-bottom: none;
        color: fuchsia;
      }
      h1 {
        font-size: 2em;
      }
      h2 {
        font-size: 1.75em;
        margin-top: 75px;
      }
      h2:first-of-type {
        margin-top: 40px;
      }
      h2,
      h3 {
        border-bottom: 1px solid #ddd;
      }
      h1,
      h2,
      h3 {
        line-height: 1.2;
      }
      p {
        font-size: 110%;
      }

      /* nav  */
      nav h3 {
        margin: 0;
        padding-bottom: 0;
        padding-left: 40px;
        font-size: 22px;
        border-bottom: none;
      }
      nav h3:not(:first-of-type) {
        margin-top: 40px;
      }
      nav h3 + ul {
        margin-top: 10px;
      }
      nav ul {
        list-style-type: none;
      }
      nav ul ul {
        list-style-type: disc;
      }

      main li code,
      main pre code:not(.sourceCode),
      main p code {
        background-color: #f7f7f7;
        padding: 5px;
      }

      /* pandoc styles */
      code {
        font-family: Menlo, Monaco, 'Courier New', monospace;
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        display: inline-block;
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
        background-color: #f7f7f7;
        border-radius: 15px;
        padding: 20px;
        color: #444;
      }
      @media screen {
        div.sourceCode {
          overflow: visible;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        /* color: red; */
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        /* color: red; */
      } /* DataType */
      code span.dv {
        color: red;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #7100f5;
        /* font-weight: bold; */
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        /* color: black; */
        /* font-weight: bold; */
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: rgb(134, 0, 134);
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */

      /* hamburger */
      /* by Erik Terwan */

      #menu-toggle {
        display: none;
        position: absolute;
        top: 50px;
        right: 50px;
        z-index: 1;
        -webkit-user-select: none;
        user-select: none;
      }

      #menu-toggle input {
        display: block;
        width: 40px;
        height: 32px;
        position: absolute;
        top: -7px;
        left: -5px;
        cursor: pointer;
        opacity: 0; /* hide this */
        z-index: 2; /* and place it over the hamburger */
        -webkit-touch-callout: none;
      }

      #menu-toggle span {
        display: block;
        width: 33px;
        height: 4px;
        margin-bottom: 5px;
        position: relative;
        background: #cdcdcd;
        border-radius: 3px;
        z-index: 1;
        transform-origin: 4px 0px;
        transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),
          background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;
      }

      #menu-toggle span {
        opacity: 1;
        background: #232323;
      }

      #menu-toggle span:first-child {
        transform-origin: 0% 0%;
      }

      #menu-toggle span:nth-last-child(2) {
        transform-origin: 0% 100%;
      }

      #menu-toggle input:checked ~ span {
        opacity: 0.25;
      }
    </style>
  </head>
  <body>
    <div id="menu-toggle">
      <input type="checkbox" onclick="clickHamburger();" />
      <span></span>
      <span></span>
      <span></span>
    </div>
    <nav><h3 id="sections">Sections</h3>
<ul>
<li><a href="#hello-world">Hello World</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#routing">Routing</a>
<ul>
<li><a href="#http-methods">HTTP Methods</a></li>
<li><a href="#route-patterns">Route Patterns</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#filters">Filters</a></li>
<li><a href="#route-modules">Route Modules</a></li>
</ul></li>
<li><a href="#requests">Requests</a>
<ul>
<li><a href="#route-parameters">Route Parameters</a></li>
<li><a href="#query-parameters">Query Parameters</a></li>
<li><a href="#form-data">Form Data</a></li>
<li><a href="#request-headers">Request Headers</a></li>
<li><a href="#other-info">Other Info</a></li>
</ul></li>
<li><a href="#responses">Responses</a>
<ul>
<li><a href="#building-responses">Building Responses</a></li>
<li><a href="#redirect">Redirect</a></li>
<li><a href="#status-codes">Status Codes</a></li>
<li><a href="#headers">Headers</a></li>
</ul></li>
<li><a href="#serving-static-files">Serving Static Files</a>
<ul>
<li><a href="#%60vial::asset_dir!%60"><code>vial::asset_dir!</code></a></li>
<li><a href="#%60asset::methods()%60"><code>asset::methods()</code></a></li>
<li><a href="#bundling-assets">Bundling Assets</a></li>
</ul></li>
<li><a href="#state">State</a>
<ul>
<li><a href="#local-state">Local State</a></li>
<li><a href="#global-state">Global State</a></li>
</ul></li>
</ul>
<h3 id="bonus-features">Bonus Features</h3>
<ul>
<li><a href="#templates">Templates</a></li>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#sessions">Sessions</a></li>
<li><a href="#json">JSON</a></li>
<li><a href="#database">Database</a></li>
<li><a href="#markdown">Markdown</a></li>
</ul>
<h3 id="links">Links</h3>
<ul>
<li><a href="https://docs.rs/vial">API Reference</a></li>
<li><a href="https://github.com/xvxx/vial">Source Code</a></li>
<li><a href="https://github.com/xvxx/vial/issues">Bug Tracker</a></li>
<li><a href="https://github.com/xvxx/vial/tree/master/examples">Examples</a></li>
<li><a href="https://crates.io/crates/vial">Crates.io</a></li>
</ul>
</nav>
    <main><p><img src="./img/drink-me.jpeg" alt="Drink Me." align="left" height="300" /></p>
<h1 id="vial">Vial</h1>
<h4 id="a-micro-micro-framework">~ a micro micro-framework ~</h4>
<p><strong>Vial</strong> is a small web framework for making small web “sites” in Rust. It includes just a handful of basic features for delivering old school, server-side rendered HTML: request routing, form data parsing, response building, and serving static file assets.</p>
<p>The goal is a small, lean core that compiles quickly and has as few dependencies as possible. Use it for HTML stuff: prototyping ideas, testing out concepts, or, perhaps, even writing tiny personal apps. Nothing serious though, got it?</p>
<p>This manual is an overview of <strong>Vial</strong>’s built-in features, as well as the few <em>optional</em> features you can enable. It also includes suggestions for some “common tasks”, like using a database to store information.</p>
<h2 id="hello-world">Hello World</h2>
<p>Here’s the bare minimum:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; |_| <span class="st">&quot;Greetings, creature.&quot;</span>;</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="op">}</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="pp">vial::run!</span>();</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="op">}</span></span></code></pre></div>
<p>That should tell you a lot, in that there isn’t a lot to <strong>Vial</strong>.</p>
<p>Now here’s a bigger bear, showing off more of <strong>Vial</strong>’s features:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; hello_world;</span>
<span id="cb2-5"><a href="#cb2-5"></a>    POST <span class="st">&quot;/&quot;</span> =&gt; redirect_to_greeting;</span>
<span id="cb2-6"><a href="#cb2-6"></a>    GET <span class="st">&quot;/:name&quot;</span> =&gt; hello_name;</span>
<span id="cb2-7"><a href="#cb2-7"></a>    GET <span class="st">&quot;/*path&quot;</span> =&gt; |req|</span>
<span id="cb2-8"><a href="#cb2-8"></a>      <span class="pp">Response::</span>from(<span class="dv">404</span>).with_body(</span>
<span id="cb2-9"><a href="#cb2-9"></a>        <span class="pp">format!</span>(<span class="st">&quot;&lt;h1&gt;404 Not Found: {}&lt;/h1&gt;&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>          req.arg(<span class="st">&quot;path&quot;</span>).unwrap_or(<span class="st">&quot;&quot;</span>)));</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="op">}</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="kw">fn</span> hello_world(_req: Request) -&gt; &amp;<span class="ot">&#39;static</span> <span class="dt">str</span> <span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="st">&quot;&lt;h1&gt;Hello, world!&lt;/h1&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="st">    &lt;p&gt;&lt;strong&gt;What&#39;s your name?&lt;/strong&gt;&lt;/p&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st">    &lt;form method=&#39;POST&#39; action=&#39;/&#39;&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">        &lt;p&gt;&lt;input name=&#39;name&#39; type=&#39;text&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="st">        &lt;p&gt;&lt;input type=&#39;submit&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="st">    &lt;/form&gt;&quot;</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="op">}</span></span>
<span id="cb2-21"><a href="#cb2-21"></a></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="kw">fn</span> redirect_to_greeting(req: Request) -&gt; <span class="dt">Option</span>&lt;<span class="kw">impl</span> Responder&gt; <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="kw">let</span> name = req.form(<span class="st">&quot;name&quot;</span>)?;</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="cn">Some</span>(<span class="pp">Response::</span>redirect_to(<span class="pp">format!</span>(<span class="st">&quot;/{}&quot;</span>, name)))</span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="op">}</span></span>
<span id="cb2-26"><a href="#cb2-26"></a></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="kw">fn</span> hello_name(req: Request) -&gt; <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="pp">format!</span>(</span>
<span id="cb2-29"><a href="#cb2-29"></a>        <span class="st">&quot;&lt;h1&gt;Why hello there, {}!&lt;/h1&gt;&quot;</span>,</span>
<span id="cb2-30"><a href="#cb2-30"></a>        req.arg(<span class="st">&quot;name&quot;</span>).unwrap()</span>
<span id="cb2-31"><a href="#cb2-31"></a>    )</span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="op">}</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>    <span class="pp">run!</span>().unwrap();</span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="op">}</span></span></code></pre></div>
<p>You can run the above example from the root of this repository:</p>
<pre><code>$ cargo run --example manual</code></pre>
<p><strong>Vial</strong> comes with a handful of examples in the <code>examples/</code> directory, so be sure to peruse them skeptically - either alongside or after digesting this manual.</p>
<h2 id="overview">Overview</h2>
<p>Like most web library thingy-jingies that only focus on server-side rendering, there are three main parts to a <strong>Vial</strong> application:</p>
<ul>
<li><p><strong><a href="#routing">Routing</a></strong>: You write actions that take a <a href="#requests">Request</a> and return either a <a href="#responses">Response</a> or a <a href="#responses">Responder</a>, then map them to URLs and URL patterns using the <a href="https://docs.rs/vial/latest/vial/macro.routes.html">vial::routes!</a> macro.</p></li>
<li><p><strong><a href="#requests">Requests</a></strong>: The <a href="#requests">Request</a> object provides information about each client’s humble request.</p></li>
<li><p><strong><a href="#responses">Responses</a></strong>: Your actions return either a <a href="#responses">Response</a> struct, which can be easily built, or a type that implements the <a href="#responses">Responder</a> trait, like <code>String</code> or <code>Option&lt;Response&gt;</code>.</p></li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p><strong>Vial</strong> should work on any recent, stable version of <strong>Rust</strong> on <strong>Linux</strong> or <strong>macOS</strong>.</p>
<p>To begin, add <strong>Vial</strong> to your project’s <code>Cargo.toml</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">[</span>dependencies<span class="op">]</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>vial = <span class="st">&quot;0.1&quot;</span></span></code></pre></div>
<p>Now all you have to do is call <code>vial::routes!</code> to define your routes and <code>vial::run!</code> to start the server in <code>src/main.rs</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; |_| <span class="st">&quot;It works!&quot;</span>;</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="op">}</span></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="pp">vial::run!</span>();</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="op">}</span></span></code></pre></div>
<p>This should start a server at <a href="http://0.0.0.0:7667" class="uri">http://0.0.0.0:7667</a> and tell you that it did. Congratulations! You’re on your way.</p>
<h2 id="routing">Routing</h2>
<p>Routing is the real gravy and potatoes of any web framework, if you think about it. In <strong>Vial</strong>, routes are defined with the <a href="https://docs.rs/vial/latest/vial/macro.routes.html">vial::routes!</a> macro in this format:</p>
<pre><code>HTTP_METHOD ROUTE_PATTERN =&gt; ACTION;</code></pre>
<p>The order in which routes are written matters - routes written first will be checked for matches first, meaning you can declare many routes that point to <code>"/"</code>, but only the first one defined will ever match.</p>
<h3 id="http-methods">HTTP Methods</h3>
<p><code>HTTP_METHOD</code> can be one of:</p>
<ul>
<li><code>GET</code></li>
<li><code>HEAD</code></li>
<li><code>POST</code></li>
<li><code>PUT</code></li>
<li><code>DELETE</code></li>
<li><code>PATCH</code></li>
</ul>
<h3 id="route-patterns">Route Patterns</h3>
<p><code>ROUTE_PATTERN</code> can be an exact match, such as <code>"/user"</code> or <code>"/v2/search.php3"</code>, or it can include a named parameter:</p>
<ol type="1">
<li><code>"/:name"</code> — This will match anything except paths with <code>/</code> or <code>.</code> in them.</li>
<li><code>"/:name.md"</code> — Use this format to match on a specific file extension.</li>
<li><code>"/*name"</code> — This will match everything, including <code>/</code> and <code>.</code></li>
</ol>
<p>In the three examples above, calling <code>request.arg("name")</code> in an Action will return <code>Some(&amp;str)</code>.</p>
<p>Note that you can have multiple parameters in the same route, as long as the “match all” pattern occurs last:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>    GET <span class="st">&quot;/:category/:id/*name&quot;</span> =&gt; |req| <span class="pp">format!</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>        <span class="st">&quot;&lt;p&gt;Category: {}&lt;/p&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">        &lt;p&gt;ID: {}&lt;/p&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="st">        &lt;p&gt;Name: {}&lt;/p&gt;&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>        req.arg(<span class="st">&quot;category&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>),</span>
<span id="cb7-7"><a href="#cb7-7"></a>        req.arg(<span class="st">&quot;id&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>),</span>
<span id="cb7-8"><a href="#cb7-8"></a>        req.arg(<span class="st">&quot;name&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>),</span>
<span id="cb7-9"><a href="#cb7-9"></a>    );</span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="op">}</span></span>
<span id="cb7-11"><a href="#cb7-11"></a></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="pp">vial::run!</span>();</span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="op">}</span></span></code></pre></div>
<h3 id="actions">Actions</h3>
<p>Actions are what routes actually route to. They are functions or closures take a <a href="#requests">Request</a> and return either a <a href="#responses">Response</a> or something that implements the <a href="#responses">Responder</a> trait:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    GET <span class="st">&quot;/info&quot;</span> =&gt; |req| <span class="pp">format!</span>(</span>
<span id="cb8-5"><a href="#cb8-5"></a>        <span class="st">&quot;&lt;p&gt;Name: {}&lt;/p&gt;&quot;</span>, req.query(<span class="st">&quot;name&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6"></a>    );</span>
<span id="cb8-7"><a href="#cb8-7"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; index;</span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="op">}</span></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="kw">fn</span> index(req: Request) -&gt; &amp;<span class="ot">&#39;static</span> <span class="dt">str</span> <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="st">&quot;&lt;form method=&#39;GET&#39;&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="st">        &lt;p&gt;Enter your name: &lt;input type=&#39;text&#39; name=&#39;name&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="st">        &lt;input type=&#39;submit&#39;/&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="st">    &lt;/form&gt;&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="op">}</span></span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    <span class="pp">run!</span>();</span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="op">}</span></span></code></pre></div>
<p>Returning <code>impl Responder</code> is easy - <a href="#responses">Responder</a> is a <strong>Vial</strong> trait that defines a single conversion method that returns a <a href="#responses">Response</a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">pub</span> <span class="kw">trait</span> Responder <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="kw">fn</span> to_response(<span class="kw">self</span>) -&gt; Response;</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="op">}</span></span></code></pre></div>
<p>These types implement <code>Responder</code> by default:</p>
<ul>
<li><code>&amp;str</code></li>
<li><code>String</code></li>
<li><code>usize</code> - Empty response with this number as the status code.</li>
<li><code>Option&lt;impl Responder&gt;</code> - 404 on <code>None</code></li>
<li><code>Result&lt;impl Responder, Error&gt;</code> - 500 on Error</li>
</ul>
<h3 id="filters">Filters</h3>
<p>Filters are functions that are run before actions. They can either modify the existing request before it’s sent to your action, or they can return a <code>Response</code> that will be delivered to the client without any actions being called:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">fn</span>(req: &amp;<span class="kw">mut</span> Request) -&gt; <span class="dt">Option</span>&lt;Response&gt;;</span></code></pre></div>
<p>Like Rust’s attributes, they can either apply to all routes defined in the same <code>vial::routes!</code> macro call or just a specific route:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">use</span> <span class="pp">std::sync::atomic::</span><span class="op">{</span>AtomicUsize, Ordering<span class="op">}</span>;</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="co">// `count` will run before all routes in this block</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="at">#![</span>filter<span class="at">(</span>count<span class="at">)]</span></span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; |_| <span class="st">&quot;Hey there!&quot;</span>;</span>
<span id="cb11-9"><a href="#cb11-9"></a>    GET <span class="st">&quot;/hits&quot;</span> =&gt; hits;</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="co">// `count` will run again when /double is visited</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>    <span class="at">#[</span>filter<span class="at">(</span>count<span class="at">)]</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>    GET <span class="st">&quot;/double&quot;</span> =&gt; double;</span>
<span id="cb11-14"><a href="#cb11-14"></a></span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="co">// `echo` will be called when /echo is visited</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="at">#[</span>filter<span class="at">(</span>echo<span class="at">)]</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>    GET <span class="st">&quot;/echo&quot;</span> =&gt; |_| <span class="st">&quot;Is there an echo in here?&quot;</span>;</span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="op">}</span></span>
<span id="cb11-19"><a href="#cb11-19"></a></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="kw">fn</span> hits(req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>    <span class="pp">format!</span>(<span class="st">&quot;Hits: {}&quot;</span>, req.counter().count())</span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="op">}</span></span>
<span id="cb11-23"><a href="#cb11-23"></a></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="kw">fn</span> double(req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>    <span class="st">&quot;Double trouble.&quot;</span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="op">}</span></span>
<span id="cb11-27"><a href="#cb11-27"></a></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="kw">fn</span> echo(req: &amp;<span class="kw">mut</span> Request) -&gt; <span class="dt">Option</span>&lt;Response&gt; <span class="op">{</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>    <span class="pp">println!</span>(<span class="st">&quot;{:#?}&quot;</span>, req);</span>
<span id="cb11-30"><a href="#cb11-30"></a>    <span class="cn">None</span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="op">}</span></span>
<span id="cb11-32"><a href="#cb11-32"></a></span>
<span id="cb11-33"><a href="#cb11-33"></a><span class="kw">fn</span> count(req: &amp;<span class="kw">mut</span> Request) -&gt; <span class="dt">Option</span>&lt;Response&gt; <span class="op">{</span></span>
<span id="cb11-34"><a href="#cb11-34"></a>    req.counter().incr();</span>
<span id="cb11-35"><a href="#cb11-35"></a>    <span class="cn">None</span></span>
<span id="cb11-36"><a href="#cb11-36"></a><span class="op">}</span></span>
<span id="cb11-37"><a href="#cb11-37"></a></span>
<span id="cb11-38"><a href="#cb11-38"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="at">,</span> <span class="bu">Default</span><span class="at">)]</span></span>
<span id="cb11-39"><a href="#cb11-39"></a><span class="kw">struct</span> Counter(AtomicUsize);</span>
<span id="cb11-40"><a href="#cb11-40"></a></span>
<span id="cb11-41"><a href="#cb11-41"></a><span class="kw">impl</span> Counter <span class="op">{</span></span>
<span id="cb11-42"><a href="#cb11-42"></a>    <span class="kw">fn</span> count(&amp;<span class="kw">self</span>) -&gt; <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb11-43"><a href="#cb11-43"></a>        <span class="kw">self</span>.<span class="dv">0</span>.load(<span class="pp">Ordering::</span>Relaxed).to_string()</span>
<span id="cb11-44"><a href="#cb11-44"></a>    <span class="op">}</span></span>
<span id="cb11-45"><a href="#cb11-45"></a></span>
<span id="cb11-46"><a href="#cb11-46"></a>    <span class="kw">fn</span> incr(&amp;<span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb11-47"><a href="#cb11-47"></a>        <span class="kw">self</span>.<span class="dv">0</span>.fetch_add(<span class="dv">1</span>, <span class="pp">Ordering::</span>Relaxed);</span>
<span id="cb11-48"><a href="#cb11-48"></a>    <span class="op">}</span></span>
<span id="cb11-49"><a href="#cb11-49"></a><span class="op">}</span></span>
<span id="cb11-50"><a href="#cb11-50"></a></span>
<span id="cb11-51"><a href="#cb11-51"></a><span class="kw">trait</span> WithCounter <span class="op">{</span></span>
<span id="cb11-52"><a href="#cb11-52"></a>    <span class="kw">fn</span> counter(&amp;<span class="kw">self</span>) -&gt; &amp;Counter;</span>
<span id="cb11-53"><a href="#cb11-53"></a><span class="op">}</span></span>
<span id="cb11-54"><a href="#cb11-54"></a></span>
<span id="cb11-55"><a href="#cb11-55"></a><span class="kw">impl</span> WithCounter <span class="kw">for</span> Request <span class="op">{</span></span>
<span id="cb11-56"><a href="#cb11-56"></a>    <span class="kw">fn</span> counter(&amp;<span class="kw">self</span>) -&gt; &amp;Counter <span class="op">{</span></span>
<span id="cb11-57"><a href="#cb11-57"></a>        <span class="kw">self</span>.<span class="pp">state::</span>&lt;Counter&gt;()</span>
<span id="cb11-58"><a href="#cb11-58"></a>    <span class="op">}</span></span>
<span id="cb11-59"><a href="#cb11-59"></a><span class="op">}</span></span>
<span id="cb11-60"><a href="#cb11-60"></a></span>
<span id="cb11-61"><a href="#cb11-61"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb11-62"><a href="#cb11-62"></a>    <span class="pp">use_state!</span>(<span class="pp">Counter::</span><span class="kw">default</span>());</span>
<span id="cb11-63"><a href="#cb11-63"></a>    <span class="pp">run!</span>().unwrap();</span>
<span id="cb11-64"><a href="#cb11-64"></a><span class="op">}</span></span></code></pre></div>
<h3 id="route-modules">Route Modules</h3>
<p>Routes can be defined in different modules and combined together with <code>vial::run!</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">mod</span> blog;</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">mod</span> wiki <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>        GET <span class="st">&quot;/wiki&quot;</span> =&gt; |_| <span class="st">&quot;This is the wiki.&quot;</span>;</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="op">}</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="op">}</span></span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; |_| <span class="st">&quot;Index page.&quot;</span>;</span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="op">}</span></span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="pp">vial::run!</span>(<span class="kw">self</span>, blog, wiki);</span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="op">}</span></span></code></pre></div>
<h2 id="requests">Requests</h2>
<p>When a route matches and an Action is called, it’s passed a <a href="#requests">Request</a> object. <code>Request</code> contains information about the request itself, as well as a number of helper methods.</p>
<h3 id="route-parameters">Route Parameters</h3>
<p>As mentioned in the <a href="#routing">Routing</a> section above, you can define parameters in a route and access their value for a given request using <code>request.arg()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>    GET <span class="st">&quot;/:animal&quot;</span> =&gt; |req| <span class="pp">format!</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>        <span class="st">&quot;Animal: {}&quot;</span>, req.arg(<span class="st">&quot;animal&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>    );</span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="op">}</span></span></code></pre></div>
<h3 id="query-parameters">Query Parameters</h3>
<p>In addition to route parameters, <strong>Vial</strong> will also parse good ol’ fashioned query string parameters for you:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>    GET <span class="st">&quot;/info&quot;</span> =&gt; |req| <span class="pp">format!</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>        <span class="st">&quot;Version: v{}&quot;</span>,</span>
<span id="cb14-4"><a href="#cb14-4"></a>        req.query(<span class="st">&quot;version&quot;</span>).unwrap_or(<span class="st">&quot;?&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a>    );</span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="op">}</span></span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="pp">vial::run!</span>();</span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="op">}</span></span></code></pre></div>
<p>Running this and visiting <code>/info</code> will show:</p>
<pre><code>Version: v?</code></pre>
<p>But visiting <code>/info?version=1.0</code> will show:</p>
<pre><code>Version: v1.0</code></pre>
<p>Like <code>arg()</code>, <code>query()</code> returns <code>Option&lt;&amp;str&gt;</code>.</p>
<h3 id="form-data">Form Data</h3>
<p>What’s the web without open ended <code>&lt;textarea&gt;s</code>? Perish the thought.</p>
<p>POSTed form data follows the same pattern as query and route parameters: use <code>request.form()</code> to access a form parameter:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">use</span> db;</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    GET <span class="st">&quot;/show/:id&quot;</span> =&gt; show;</span>
<span id="cb17-6"><a href="#cb17-6"></a>    GET <span class="st">&quot;/new&quot;</span> =&gt; new;</span>
<span id="cb17-7"><a href="#cb17-7"></a>    POST <span class="st">&quot;/new&quot;</span> =&gt; create;</span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="op">}</span></span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="kw">fn</span> new(_req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="st">&quot;&lt;form method=&#39;POST&#39;&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="st">        &lt;p&gt;Name: &lt;input type=&#39;text&#39; name=&#39;name&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="st">        &lt;p&gt;Location: &lt;input type=&#39;text&#39; name=&#39;location&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="st">        &lt;p&gt;&lt;input type=&#39;submit&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="st">    &lt;/form&gt;&quot;</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="op">}</span></span>
<span id="cb17-17"><a href="#cb17-17"></a></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="kw">fn</span> create(req: Request) -&gt; <span class="dt">Result</span>&lt;<span class="kw">impl</span> Responder, <span class="pp">io::</span>Error&gt; <span class="op">{</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>    <span class="kw">let</span> id = <span class="pp">db::insert!</span>(</span>
<span id="cb17-20"><a href="#cb17-20"></a>        <span class="st">&quot;name&quot;</span> =&gt; req.form(<span class="st">&quot;name&quot;</span>).unwrap(),</span>
<span id="cb17-21"><a href="#cb17-21"></a>        <span class="st">&quot;location&quot;</span> =&gt; req.form(<span class="st">&quot;location&quot;</span>).unwrap()</span>
<span id="cb17-22"><a href="#cb17-22"></a>    )?;</span>
<span id="cb17-23"><a href="#cb17-23"></a>    <span class="cn">Ok</span>(<span class="pp">Response::</span>redirect_to(<span class="pp">format!</span>(<span class="st">&quot;/show/{}&quot;</span>, id)))</span>
<span id="cb17-24"><a href="#cb17-24"></a><span class="op">}</span></span>
<span id="cb17-25"><a href="#cb17-25"></a></span>
<span id="cb17-26"><a href="#cb17-26"></a><span class="kw">fn</span> show(req: Request) -&gt; <span class="dt">Option</span>&lt;<span class="kw">impl</span> Responder&gt; <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="kw">let</span> record = <span class="pp">db::query!</span>(<span class="st">&quot;id&quot;</span> =&gt; id).ok()?;</span>
<span id="cb17-28"><a href="#cb17-28"></a>    <span class="pp">format!</span>(</span>
<span id="cb17-29"><a href="#cb17-29"></a>        <span class="st">&quot;&lt;p&gt;Name: {}&lt;/p&gt;</span></span>
<span id="cb17-30"><a href="#cb17-30"></a><span class="st">        &lt;p&gt;Location: {}&lt;/p&gt;&quot;</span>,</span>
<span id="cb17-31"><a href="#cb17-31"></a>        record.get(<span class="st">&quot;name&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>),</span>
<span id="cb17-32"><a href="#cb17-32"></a>        record.get(<span class="st">&quot;location&quot;</span>).unwrap_or(<span class="st">&quot;None&quot;</span>),</span>
<span id="cb17-33"><a href="#cb17-33"></a>    )</span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="op">}</span></span>
<span id="cb17-35"><a href="#cb17-35"></a></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb17-37"><a href="#cb17-37"></a>    <span class="pp">run!</span>();</span>
<span id="cb17-38"><a href="#cb17-38"></a><span class="op">}</span></span></code></pre></div>
<h3 id="request-headers">Request Headers</h3>
<p>Headers are available without any of the peksy conveniences of type safety. Just give <code>request.header()</code> a string and hope you get one back!</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span>fs, <span class="pp">path::</span><span class="dt">Path</span><span class="op">}</span>;</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    GET <span class="st">&quot;/:file&quot;</span> =&gt; show;</span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="op">}</span></span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="kw">fn</span> show(req: Request) -&gt; <span class="dt">Option</span>&lt;<span class="kw">impl</span> Responder&gt; <span class="op">{</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="kw">let</span> path = <span class="pp">format!</span>(<span class="st">&quot;./{}&quot;</span>, req.arg(<span class="st">&quot;file&quot;</span>)?);</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="kw">if</span> <span class="dt">Path</span>::new(&amp;path).exists() <span class="op">{</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>        <span class="kw">if</span> req.header(<span class="st">&quot;Accept&quot;</span>).unwrap_or(<span class="st">&quot;?&quot;</span>).starts_with(<span class="st">&quot;text/plain&quot;</span>) <span class="op">{</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>            <span class="cn">Some</span>(<span class="pp">Response::</span>from_header(<span class="st">&quot;Content-Type&quot;</span>, <span class="st">&quot;text/plain&quot;</span>)</span>
<span id="cb18-13"><a href="#cb18-13"></a>                .with_file(&amp;path))</span>
<span id="cb18-14"><a href="#cb18-14"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>            <span class="kw">let</span> file = <span class="pp">fs::</span>read_to_string(&amp;path).unwrap();</span>
<span id="cb18-16"><a href="#cb18-16"></a>            <span class="cn">Some</span>(<span class="pp">Response::</span>from_body(<span class="pp">format!</span>(</span>
<span id="cb18-17"><a href="#cb18-17"></a>                <span class="st">&quot;&lt;html&gt;&lt;body&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="st">                &lt;pre style=&#39;width:50%;margin:0 auto&#39;&gt;{}&lt;/pre&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="st">                &lt;/body&gt;&lt;/html&gt;&quot;</span>, file)))</span>
<span id="cb18-20"><a href="#cb18-20"></a>        <span class="op">}</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb18-22"><a href="#cb18-22"></a>        <span class="cn">None</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>    <span class="op">}</span></span>
<span id="cb18-24"><a href="#cb18-24"></a><span class="op">}</span></span>
<span id="cb18-25"><a href="#cb18-25"></a></span>
<span id="cb18-26"><a href="#cb18-26"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb18-27"><a href="#cb18-27"></a>    <span class="pp">run!</span>();</span>
<span id="cb18-28"><a href="#cb18-28"></a><span class="op">}</span></span></code></pre></div>
<p>Header names are case insensitive, though, so at least you don’t have to worry about that.</p>
<h3 id="other-info">Other Info</h3>
<p>Beyond the headers, <code>Request</code> also surfaces a few more basic bits of information such as the <code>request.method()</code> and <code>request.path()</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">impl</span> Request <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>    <span class="co">// &quot;GET&quot;, &quot;POST&quot;, etc. Always uppercase.</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="kw">fn</span> method(&amp;<span class="kw">self</span>) -&gt; &amp;<span class="dt">str</span>;</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="co">// Always starts with &quot;/&quot;</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="kw">fn</span> path(&amp;<span class="kw">self</span>) -&gt; &amp;<span class="dt">str</span>;</span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="op">}</span></span></code></pre></div>
<h2 id="responses">Responses</h2>
<p>Every Action returns either a <a href="#responses">Response</a> or a type that implements the <a href="#responses">Responder</a> trait’s single method:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">pub</span> <span class="kw">trait</span> Responder <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>    <span class="kw">fn</span> to_response(<span class="kw">self</span>) -&gt; Response;</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="op">}</span></span></code></pre></div>
<p>Common types like <code>&amp;str</code> and <code>Option&lt;String&gt;</code> already implement this, so you are free to be lazy and return simple types in your Actions. If, however, you want to set headers and do other fancy jazz, you’ll need to build and return a <a href="#responses">Response</a> directly.</p>
<p>Rather than use the “Builder” pattern like more mature and better designed libraries, <strong>Vial’s</strong> <a href="#responses">Response</a> lets you set properties either directly or using Builder-style methods:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb21-1"><a href="#cb21-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>    GET <span class="st">&quot;/404&quot;</span> =&gt; |_| <span class="pp">Response::</span>from(<span class="dv">404</span>).with_text(<span class="st">&quot;404 Not Found&quot;</span>);</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="op">}</span></span></code></pre></div>
<p>Each <code>Response</code> defaults to a <code>Content-Type</code> of <code>text/html; charset=utf8</code>, so you can build HTML with your bare hands:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">fn</span> index(_req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="pp">Response::</span>from(<span class="st">&quot;&lt;marquee&gt;Coming soon!&lt;/marquee&gt;&quot;</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="op">}</span></span></code></pre></div>
<p>To produce plain text, set the header using <code>with_header()</code> or <code>set_header()</code>, or use <code>with_text()</code> instead of <code>with_body()</code> or <code>from_body()</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">fn</span> readme(_req: Request) -&gt; Response <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="co">// This will be rendered as plain text.</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="pp">Response::</span>from_file(<span class="st">&quot;README.md&quot;</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a>        .with_header(<span class="st">&quot;Content-Type&quot;</span>, <span class="st">&quot;text/plain&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="op">}</span></span></code></pre></div>
<h3 id="building-responses">Building Responses</h3>
<p>The <a href="https://docs.rs/vial/latest/vial/struct.Response.html">Response</a> documentation contains more information on all the methods available, but here are some of the properties you can set on a <a href="#responses">Response</a> in your actions:</p>
<ul>
<li><p><code>fn from_text&lt;S: AsRef&lt;str&gt;&gt;(text: S) -&gt; Response;</code></p></li>
<li><p><code>fn with_code(mut self, code: usize) -&gt; Response;</code></p></li>
<li><p><code>fn with_body&lt;S: AsRef&lt;str&gt;&gt;(mut self, body: S) -&gt; Response;</code></p></li>
<li><p><code>fn with_text&lt;S: AsRef&lt;str&gt;&gt;(self, text: S) -&gt; Response;</code></p></li>
<li><p><code>fn with_reader(mut self, reader: Box&lt;dyn io::Read&gt;) -&gt; Response;</code></p></li>
<li><p><code>fn with_asset(mut self, path: &amp;str) -&gt; Response;</code></p></li>
<li><p><code>fn with_file(mut self, path: &amp;str) -&gt; Response;</code></p></li>
<li><p><code>fn with_error&lt;E: error::Error&gt;(self, err: E) -&gt; Response;</code></p></li>
<li><p><code>fn with_header(mut self, key: &amp;str, value: &amp;str) -&gt; Response;</code></p></li>
</ul>
<h3 id="redirect">Redirect</h3>
<p>To issue a 302 redirect, use the <code>redirect_to</code> static method:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">fn</span> search(req: Request) -&gt; <span class="dt">Option</span>&lt;<span class="kw">impl</span> Responder&gt; <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="kw">let</span> url = <span class="pp">format!</span>(</span>
<span id="cb24-3"><a href="#cb24-3"></a>        <span class="st">&quot;https://en.wikipedia.org/wiki/Special:Search?search={}&quot;</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>        req.arg(<span class="st">&quot;search&quot;</span>)?</span>
<span id="cb24-5"><a href="#cb24-5"></a>    )</span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="cn">Some</span>(<span class="pp">Response::</span>redirect_to(url))</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="op">}</span></span></code></pre></div>
<h3 id="status-codes">Status Codes</h3>
<p>Empty responses with status codes can be created from <code>usize</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">fn</span> fourohno(_req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>    <span class="pp">Response::</span>from(<span class="dv">404</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="op">}</span></span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="kw">fn</span> pay_me(_req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>    <span class="dv">402</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="op">}</span></span></code></pre></div>
<h3 id="headers">Headers</h3>
<p>Headers can be set Builder-style using <code>with_header</code> or imperative-style using <code>set_header</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">fn</span> not_found(_req: Request) -&gt; Response <span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="pp">Response::</span>from(<span class="dv">404</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>        .with_header(<span class="st">&quot;Content-Type&quot;</span>, <span class="st">&quot;text/plain&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>        .with_body(<span class="st">&quot;404 Not Found&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="op">}</span></span>
<span id="cb26-6"><a href="#cb26-6"></a></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="kw">fn</span> download(req: Request) -&gt; <span class="dt">Option</span>&lt;<span class="kw">impl</span> Responder&gt; <span class="op">{</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="pp">Response::</span>from_file(req.arg(<span class="st">&quot;file&quot;</span>)?)</span>
<span id="cb26-9"><a href="#cb26-9"></a>        .with_header(<span class="st">&quot;Content-Type&quot;</span>, <span class="st">&quot;application/octet-stream&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="op">}</span></span>
<span id="cb26-11"><a href="#cb26-11"></a></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="kw">fn</span> perm_redirect(url: &amp;<span class="dt">str</span>) -&gt; Response <span class="op">{</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>    <span class="pp">Response::</span>from(<span class="dv">301</span>).with_header(<span class="st">&quot;Location&quot;</span>, url)</span>
<span id="cb26-14"><a href="#cb26-14"></a><span class="op">}</span></span></code></pre></div>
<h2 id="serving-static-files">Serving Static Files</h2>
<p><strong>Vial</strong> can automatically serve static files out of an asset directory, complete with proper ETag handling, if you tell it which directory to use with the <code>vial::asset_dir!</code> macro. It can also optionally bundle those assets them into your application in <code>--release</code> mode, producing a single binary that was developed as if it used separate CSS and JS files.</p>
<h3 id="vialasset_dir"><code>vial::asset_dir!</code></h3>
<p>To get started, put all your <code>.js</code> and <code>.css</code> and other static assets into a directory in the root of your project, such as <code>assets/</code>. In your HTML, include those files as if the “assets” directory were the root of your application. So if you have “assets/app.js”, in your <code>&lt;script&gt;</code> tag you would include just “/app.js”.</p>
<p>Next call <a href="https://docs.rs/vial/latest/vial/macro.asset_dir.html">vial::asset_dir!()</a> with the path to your asset directory (maybe <code>assets/</code>?) before starting your application with <a href="run%20api">vial::run!</a>:</p>
<p>If we had a directory structure like this:</p>
<pre><code>.
├── README.md
├── assets
│   └── img
│       ├── banker.png
│       └── doctor.png
└── src
    └── main.rs</code></pre>
<p>We could serve our images like so:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb28-1"><a href="#cb28-1"></a><span class="pp">vial::routes!</span> <span class="op">{</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; |_| <span class="st">&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="st">        &lt;p&gt;&lt;img src=&#39;/img/doctor.png&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="st">        &lt;p&gt;&lt;img src=&#39;/img/banker.png&#39;/&gt;&lt;/p&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="st">    &quot;</span>;</span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="op">}</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>    <span class="pp">vial::asset_dir!</span>(<span class="st">&quot;assets/&quot;</span>);</span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="pp">vial::run!</span>().unwrap();</span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="op">}</span></span></code></pre></div>
<h3 id="assetmethods"><code>asset::methods()</code></h3>
<p>By setting an asset directory, either through the <a href="https://docs.rs/vial/latest/vial/macro.asset_dir.html">vial::asset_dir!()</a> or [vial::bundle_assets!()][bundle_assets api] macro, you can then use the methods in the <code>asset::</code> module to work with them:</p>
<ul>
<li><p><strong><a href="https://docs.rs/vial/latest/vial/assets/#method.etag">asset::etag()</a></strong>: Get the ETag for an asset. Used automatically by the Router if a web request matches an asset’s path.</p></li>
<li><p><strong><a href="https://docs.rs/vial/latest/vial/assets/#method.exists">asset::exists()</a></strong>: Does an asset exist? Works regardless of whether the asset is bundled or not.</p></li>
<li><p><strong><a href="https://docs.rs/vial/latest/vial/assets/#method.is_bundled">asset::is_bundled()</a></strong>: Are assets bundled? Only true in <code>--release</code> mode and when used with the <code>vial::bundle_assets!()</code> macro.</p></li>
<li><p><strong><a href="https://docs.rs/vial/latest/vial/assets/#method.to_string">asset::to_string()</a></strong>: Like <code>fs::read_to_string()</code>, delivers the content of an asset as a <code>String</code>.</p></li>
<li><p><strong><a href="https://docs.rs/vial/latest/vial/assets/#method.as_reader">asset::as_reader()</a></strong>: Like <code>asset::to_string()</code> but provides an <code>io::Read</code> of an asset, whether or not it’s bundled.</p></li>
</ul>
<h3 id="bundling-assets">Bundling Assets</h3>
<p><strong>Vial</strong> is meant to be small and swift, like a ninja star. Part of that means <strong>Vial</strong> apps should be able to compile into <em>standalone binaries</em> that don’t rely on the filesystem. In order to accomplish this, <strong>Vial</strong> can bundle your assets into your final <code>--release</code> binary for you. As long as you the <code>asset::()</code> API described above to access them, all your code will work the same whether your assets are bundled or not.</p>
<p>Combined with the ETag support, this means all assets will be reloaded by your browser whenever they’re modified in dev mode for a smoother developmental experience.</p>
<p>To bundle your assets into your final binary in release mode, you must:</p>
<ol type="1">
<li><p><strong>REMOVE</strong> any calls to the <code>vial::asset_dir!()</code> macro.</p></li>
<li><p>Add <code>vial</code> as to <code>[build-dependencies]</code> in your <code>Cargo.toml</code>:</p></li>
</ol>
<pre class="toml"><code>[build-dependencies]
vial = &quot;0.1&quot;</code></pre>
<p>(<em>Yes, you should now have <code>vial</code> in there twice. Once for <code>build-dependencies</code> and once for <code>dependencies</code>. Only the one under <code>dependencies</code> needs to list any optional features you want to use, however.</em>)</p>
<ol start="3" type="1">
<li>Create a <code>bundle.rs</code> and call <code>vial::bundle_assets!()</code> in it, passing your asset directory as the sole argument:</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>    <span class="pp">vial::bundle_assets!</span>(<span class="st">&quot;assets/&quot;</span>).unwrap();</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="op">}</span></span></code></pre></div>
<p><strong>⚠️ Note:</strong> Bundling assets and setting an asset path using <code>vial::asset_dir!()</code> are mutually exclusive - you can’t do both, as enabling bundling will set the asset path for you. Therefor if you are making the transition from using-assets-but-not-bundling to using-assets-and-bundling-them, make sure to remove your call to <code>vial::asset_dir!</code>.</p>
<p>Other than that, you’re all set! Your application will now bundle your assets in <code>--release</code> mode and use the disk in debug and test mode.</p>
<p>All calls to functions in the <a href="https://docs.rs/vial/latest/vial/assets/">assets</a> module should work with the files in your asset directory. Add more and get to it!</p>
<h2 id="state">State</h2>
<p>There are two types of state available in <strong>Vial</strong>:</p>
<ol type="1">
<li><p>Local State - Built-in to <a href="#requests">Request</a>. Allows caching of expensive algorithms (like DB lookups) on a per-request basis.</p></li>
<li><p>Global State - Requires the <code>state</code> feature. Allows you to share any <code>Send + Sync + 'static</code> types (like database connections) across all requests.</p></li>
</ol>
<h3 id="local-state">Local State</h3>
<p>Local state lives for only a single <a href="#requests">Request</a>, but can be useful to prevent looking up the same data over and over. The cache is based on the return type of the function or closure you pass to <code>cache()</code>, so make sure to create little wrapper structs if you want different functions to return the same type, like <code>Vec&lt;String&gt;</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">struct</span> PageNames(<span class="dt">Vec</span>&lt;<span class="dt">String</span>&gt;);</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">struct</span> UserNames(<span class="dt">Vec</span>&lt;<span class="dt">String</span>&gt;);</span></code></pre></div>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="kw">use</span> <span class="pp">page::</span>Page;</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="kw">use</span> db;</span>
<span id="cb32-4"><a href="#cb32-4"></a></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>    GET <span class="st">&quot;/&quot;</span> =&gt; list;</span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="op">}</span></span>
<span id="cb32-8"><a href="#cb32-8"></a></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="kw">struct</span> PageNames(<span class="dt">Vec</span>&lt;<span class="dt">String</span>&gt;);</span>
<span id="cb32-10"><a href="#cb32-10"></a></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="kw">fn</span> all_pages(_: &amp;Request) -&gt; <span class="dt">Vec</span>&lt;Page&gt; <span class="op">{</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>    <span class="pp">db::</span>lookup(<span class="st">&quot;select * from pages&quot;</span>)</span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="op">}</span></span>
<span id="cb32-14"><a href="#cb32-14"></a></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="kw">fn</span> page_names(req: &amp;Request) -&gt; PageNames <span class="op">{</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>    PageNames(req.cache(all_pages)</span>
<span id="cb32-17"><a href="#cb32-17"></a>        .iter()</span>
<span id="cb32-18"><a href="#cb32-18"></a>        .map(|page| page.name.clone())</span>
<span id="cb32-19"><a href="#cb32-19"></a>        .<span class="pp">collect::</span>&lt;<span class="dt">Vec</span>&lt;_&gt;&gt;())</span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="op">}</span></span>
<span id="cb32-21"><a href="#cb32-21"></a></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="kw">fn</span> list_of_names(req: &amp;Request) -&gt; <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb32-23"><a href="#cb32-23"></a>    req.cache(page_names)</span>
<span id="cb32-24"><a href="#cb32-24"></a>        .<span class="dv">0</span></span>
<span id="cb32-25"><a href="#cb32-25"></a>        .iter()</span>
<span id="cb32-26"><a href="#cb32-26"></a>        .map(|name| <span class="pp">format!</span>(<span class="st">&quot;&lt;li&gt;{}&lt;/li&gt;&quot;</span>, name))</span>
<span id="cb32-27"><a href="#cb32-27"></a>        .<span class="pp">collect::</span>&lt;<span class="dt">Vec</span>&lt;_&gt;&gt;()</span>
<span id="cb32-28"><a href="#cb32-28"></a>        .join(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb32-29"><a href="#cb32-29"></a><span class="op">}</span></span>
<span id="cb32-30"><a href="#cb32-30"></a></span>
<span id="cb32-31"><a href="#cb32-31"></a><span class="kw">fn</span> list(req: Request) -&gt; <span class="kw">impl</span> Responder <span class="op">{</span></span>
<span id="cb32-32"><a href="#cb32-32"></a>    <span class="pp">format!</span>(</span>
<span id="cb32-33"><a href="#cb32-33"></a>        <span class="st">&quot;&lt;html&gt;</span></span>
<span id="cb32-34"><a href="#cb32-34"></a><span class="st">            &lt;head&gt;&lt;title&gt;{title}&lt;/title&gt;&lt;/head&gt;</span></span>
<span id="cb32-35"><a href="#cb32-35"></a><span class="st">            &lt;body&gt;</span></span>
<span id="cb32-36"><a href="#cb32-36"></a><span class="st">                &lt;h1&gt;{title}&lt;/h1&gt;</span></span>
<span id="cb32-37"><a href="#cb32-37"></a><span class="st">                &lt;h3&gt;There are {page_count} pages:&lt;/h3&gt;</span></span>
<span id="cb32-38"><a href="#cb32-38"></a><span class="st">                &lt;ul&gt;</span></span>
<span id="cb32-39"><a href="#cb32-39"></a><span class="st">                    {pages}</span></span>
<span id="cb32-40"><a href="#cb32-40"></a><span class="st">                &lt;/ul&gt;</span></span>
<span id="cb32-41"><a href="#cb32-41"></a><span class="st">            &lt;/body&gt;</span></span>
<span id="cb32-42"><a href="#cb32-42"></a><span class="st">        &lt;/html&gt;&quot;</span>,</span>
<span id="cb32-43"><a href="#cb32-43"></a>        title = <span class="st">&quot;List Pages&quot;</span>,</span>
<span id="cb32-44"><a href="#cb32-44"></a>        page_count = req.cache(all_pages).len(),</span>
<span id="cb32-45"><a href="#cb32-45"></a>        pages = req.cache(list_of_names),</span>
<span id="cb32-46"><a href="#cb32-46"></a>    )</span>
<span id="cb32-47"><a href="#cb32-47"></a><span class="op">}</span></span>
<span id="cb32-48"><a href="#cb32-48"></a></span>
<span id="cb32-49"><a href="#cb32-49"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb32-50"><a href="#cb32-50"></a>    <span class="pp">run!</span>().unwrap();</span>
<span id="cb32-51"><a href="#cb32-51"></a><span class="op">}</span></span></code></pre></div>
<h3 id="global-state">Global State</h3>
<p>There are three steps involved in setting up shared, global state in <strong>Vial</strong>:</p>
<ol type="1">
<li>Enable the <code>state</code> feature in your <code>Cargo.toml</code>:</li>
</ol>
<pre class="toml"><code>[Dependencies]
vial = { version = &quot;*&quot;, features=[&quot;state&quot;] }</code></pre>
<ol start="2" type="1">
<li>Create a struct that is <code>Send + Sync</code> to hold your application’s shared state:</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">use</span> vial;</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="kw">use</span> <span class="pp">std::sync::</span><span class="op">{</span>Arc, Mutx, <span class="pp">atomic::</span><span class="op">{</span>AtomicUsize, Ordering<span class="op">}}</span>;</span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="kw">use</span> <span class="pp">some_db_crate::</span>DB;</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="kw">struct</span> MyConfig <span class="op">{</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>    db: Arc&lt;Mutex&lt;DB&gt;&gt;,</span>
<span id="cb34-7"><a href="#cb34-7"></a>    counter: AtomicUsize,</span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="op">}</span></span>
<span id="cb34-9"><a href="#cb34-9"></a></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="kw">impl</span> MyConfig <span class="op">{</span></span>
<span id="cb34-11"><a href="#cb34-11"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new(db: DB) <span class="op">{</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>        MyConfig <span class="op">{</span></span>
<span id="cb34-13"><a href="#cb34-13"></a>            db: <span class="pp">Arc::</span>new(<span class="pp">Mutex::</span>new(db)),</span>
<span id="cb34-14"><a href="#cb34-14"></a>            counter: <span class="pp">AtomicUsize::</span>new(<span class="dv">0</span>),</span>
<span id="cb34-15"><a href="#cb34-15"></a>        <span class="op">}</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>    <span class="op">}</span></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="op">}</span></span></code></pre></div>
<ol start="3" type="1">
<li>Tell <strong>Vial</strong> about your state object before calling <code>run!</code>:</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>    <span class="kw">let</span> db = <span class="pp">DB::</span>new();</span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="pp">vial::use_state!</span>(<span class="pp">MyConfig::</span>new(db));</span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="pp">vial::run!</span>();</span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="op">}</span></span></code></pre></div>
<p>Now your actions and filters can access <code>MyConfig</code> by calling the <a href="struct.Request.html#method.state">state()</a> method on <a href="#requests">Request</a>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>    GET <span class="st">&quot;/list&quot;</span> =&gt; list;</span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="op">}</span></span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="kw">fn</span> find_names(db: Arc&lt;Mutex&lt;DB&gt;&gt;) -&gt; <span class="dt">Result</span>&lt;<span class="dt">Vec</span>&lt;<span class="dt">String</span>&gt;, <span class="pp">db::</span>Error&gt; <span class="op">{</span></span>
<span id="cb36-8"><a href="#cb36-8"></a>    <span class="cn">Ok</span>(db.lock()?.query(<span class="st">&quot;SELECT name FROM names&quot;</span>)?</span>
<span id="cb36-9"><a href="#cb36-9"></a>        .map(|row| row.get(<span class="st">&quot;name&quot;</span>)?)</span>
<span id="cb36-10"><a href="#cb36-10"></a>        .<span class="pp">collect::</span>&lt;<span class="dt">Vec</span>&lt;_&gt;&gt;())</span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="op">}</span></span>
<span id="cb36-12"><a href="#cb36-12"></a></span>
<span id="cb36-13"><a href="#cb36-13"></a><span class="kw">fn</span> list(req: Request) -&gt; <span class="dt">Result</span>&lt;<span class="dt">String</span>&gt; <span class="op">{</span></span>
<span id="cb36-14"><a href="#cb36-14"></a>    <span class="cn">Ok</span>(</span>
<span id="cb36-15"><a href="#cb36-15"></a>        find_names(req.<span class="pp">state::</span>&lt;MyConfig&gt;().db.clone())?</span>
<span id="cb36-16"><a href="#cb36-16"></a>            .map(|name| <span class="pp">format!</span>(<span class="st">&quot;&lt;li&gt;{}&lt;/li&gt;&quot;</span>, name))</span>
<span id="cb36-17"><a href="#cb36-17"></a>            .join(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb36-18"><a href="#cb36-18"></a>    )</span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="op">}</span></span></code></pre></div>
<p>You might find it more convenient to define and implement a local trait on the <a href="#requests">Request</a> struct instead of calling <code>request.state()</code> directly:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">use</span> <span class="pp">vial::prelude::</span>*;</span>
<span id="cb37-2"><a href="#cb37-2"></a></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="pp">routes!</span> <span class="op">{</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>    GET <span class="st">&quot;/list&quot;</span> =&gt; list;</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="op">}</span></span>
<span id="cb37-6"><a href="#cb37-6"></a></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co">// ...</span></span>
<span id="cb37-8"><a href="#cb37-8"></a></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="kw">trait</span> WithConfig <span class="op">{</span></span>
<span id="cb37-10"><a href="#cb37-10"></a>    <span class="kw">fn</span> config(&amp;<span class="kw">self</span>) -&gt; &amp;MyConfig;</span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="op">}</span></span>
<span id="cb37-12"><a href="#cb37-12"></a></span>
<span id="cb37-13"><a href="#cb37-13"></a><span class="kw">impl</span> WithConfig <span class="kw">for</span> <span class="pp">vial::</span>Request <span class="op">{</span></span>
<span id="cb37-14"><a href="#cb37-14"></a>    <span class="kw">fn</span> config(&amp;<span class="kw">self</span>) -&gt; &amp;MyConfig <span class="op">{</span></span>
<span id="cb37-15"><a href="#cb37-15"></a>        <span class="kw">self</span>.<span class="pp">state::</span>&lt;MyConfig&gt;()</span>
<span id="cb37-16"><a href="#cb37-16"></a>    <span class="op">}</span></span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="op">}</span></span>
<span id="cb37-18"><a href="#cb37-18"></a></span>
<span id="cb37-19"><a href="#cb37-19"></a><span class="kw">fn</span> list(req: Request) -&gt; <span class="dt">Result</span>&lt;<span class="dt">String</span>&gt; <span class="op">{</span></span>
<span id="cb37-20"><a href="#cb37-20"></a>    <span class="cn">Ok</span>(</span>
<span id="cb37-21"><a href="#cb37-21"></a>        find_names(req.config().db.clone())?</span>
<span id="cb37-22"><a href="#cb37-22"></a>            .map(|name| <span class="pp">format!</span>(<span class="st">&quot;&lt;li&gt;{}&lt;/li&gt;&quot;</span>, name))</span>
<span id="cb37-23"><a href="#cb37-23"></a>            .join(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb37-24"><a href="#cb37-24"></a>    )</span>
<span id="cb37-25"><a href="#cb37-25"></a><span class="op">}</span></span></code></pre></div>
<h2 id="templates">Templates</h2>
<p><em>Optional Feature: Coming soon.</em></p>
<h2 id="cookies">Cookies</h2>
<p><em>Optional Feature: Coming soon.</em></p>
<h2 id="sessions">Sessions</h2>
<p><em>Optional Feature: Coming soon.</em></p>
<h2 id="json">JSON</h2>
<p><em>Optional Feature: Coming soon.</em></p>
<h2 id="database">Database</h2>
<p><em>“Pro Tip”: Coming soon.</em></p>
<h2 id="markdown">Markdown</h2>
<p><em>“Pro Tip”: Coming soon.</em></p>
</main>
    <script>
      function clickHamburger() {
        let nav = document.getElementsByTagName("nav")[0];
        if (nav.className == "show-mobile") nav.className = "";
        else nav.className = "show-mobile";
        window.scrollTo(0, 0);
      }
    </script>
  </body>
</html>
